@model IEnumerable<BulkyBook.Models.ApplicationUser>
@using BulkyBook.Utility

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<br />

<div id="lockAlert" class="alert alert-danger alert-dismissible fade show invisible" style="" role="alert">   
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<div class="row">
    <div class="col-6">
        <h2 class="text-primary">User's List </h2>
    </div>
    @if (ViewBag.userCount - ViewBag.userCountStart < 2)
    {
        <div class="col-6 text-right">
            <a class="btn btn-primary" asp-area="Identity" asp-page="/Account/Register">
                <i class="fas fa-plus"></i>
                &nbsp; Create New User
            </a>
        </div>
    }
    else
    {
        <div class="col-6 text-right">
            <button class="btn btn-primary" onclick=setAlert("create")>
                <i class="fas fa-plus"></i>
                &nbsp; Create New User
            </button>
        </div>
    }
</div>

<br />
<div class="p-4 border rounded table-responsive">    
        <table id="tblData" class="table table-striped table-bordered" style="width:100%">
            <thead class="thead-dark">
                <tr class="table-info">
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Company</th>
                    <th>Role</th>
                    <th></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            @Html.DisplayFor(modelItem => item.Name)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Email)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.PhoneNumber)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Company.Name)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Role)
                        </td>
                        <td id="lockTd">
                            <a onclick=setAlert("lock") class="btn btn-success text-white text-center" style="cursor:pointer; width:80px;">
                                <i class="fas fa-lock"></i> LOCK
                            </a>
                        </td>
                        @if (User.IsInRole(SD.Role_Admin))
                        {
                            <td>
                                <form asp-area="Admin" asp-action="Delete" asp-route-id="@item.Id" method="post">
                                    <button type="submit" class="btn btn-danger text-white btn-sm"><i class="fas fa-trash-alt justify-content-end"> </i></button>
                                </form>
                            </td>
                        }
                    </tr>
                }
            </tbody>
        </table>    
</div>

@section Scripts{

    <script src="~/js/user.js"></script>
<script>
    function setAlert(text) {
        var newText;        
        if (text == "lock") {
            newText = "Only Admins can lock users!";
        }
        else { newText = "You can't create more users!";}
        var myDiv = document.getElementById('lockAlert');
        myDiv.innerHTML = newText;
        myDiv.classList.toggle("invisible");
    }
</script>
}